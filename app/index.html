<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<title>Погода</title>
	<link rel="stylesheet" href="css/style.min.css">
	<script>
		const ws = new WebSocket('ws://localhost:8080')
		ws.onopen = () => {
			document.querySelector('body > div > aside > button > i').onclick = () => {
				console.log('sent')
				ws.send(JSON.stringify({
					action: 'currentWeather',
					data: {
						city: document.querySelector('body > div > aside > input').value
					}
				}))
			}
		}
		ws.onmessage = msg => {
			const message = JSON.parse(msg)
			if (message.action == 'response') {
				const currentWeather = message.data.fact
				// температура
				document.querySelector('body > div > div > main > h2').textContent = `${currentWeather.temp}°`
				document.querySelector('body > div > div > main > div > div.weather__city-details-wrapper > h2').textContent = message.data.city
				let date = new Date(message.data.now_dt)
				document.querySelector('body > div > div > main > div > div.weather__city-details-wrapper > p > time').textContent = `${date.getHours()}:${date.getMinutes()} - ${date.toLocaleTimeString('ru-RU', { weekday: 'long' })}, ${date.toLocaleDateString('ru-RU', { day: 'numeric' })} ${date.toLocaleDateString('ru-RU', { month: 'short' })}`
			}
		}
	</script>
</head>
<body>
	<div class="weather">

		<aside class="sidebar"> <!-- Сайдбар -->
			<input class="sidebar__search" type="text" placeholder="Найти другой город...">
			<button class="btn btn--submit">
				<i class="fa fa-search icon i-hover"></i>
			</button>

			<ul class="sidebar__list">
				<li class="sidebar__item">
					<p class="sidebar-text">
						Геленджик
					</p>
				</li>
				<li class="sidebar__item">
					<p class="sidebar-text">
						Краснодар
					</p>
				</li>
				<li class="sidebar__item">
					<p class="sidebar-text">
						Новороссийск
					</p>
				</li>
				<li class="sidebar__item">
					<p class="sidebar-text">
						Сочи
					</p>
				</li>
			</ul>

			<div class="sidebar__details">
				<h2 class="sidebar__header">Подробнее о погоде</h2>
				<ul class="sidebar__list">
					<li class="sidebar__item sidebar__item--details">
						<p class="sidebar__text sidebar__text_details">Облачность</p>
						<p class="sidebar__indicators">72%</p>
					</li>

					<li class="sidebar__item sidebar__item--details">
						<p class="sidebar__text sidebar__text_details">Влажность</p>
						<p class="sidebar__indicators">56%</p>
					</li>

					<li class="sidebar__item sidebar__item--details">
						<p class="sidebar__text sidebar__text_details">Ветер</p>
						<p class="sidebar__indicators">7 км/ч</p>
					</li>
					<li class="sidebar__item sidebar__item--details">
						<p class="sidebar__text sidebar__text_details">Давление</p>
						<p class="sidebar__indicators">750 мм рт.ст</p>
					</li>
				</ul>
				<a class="btn" href="days.html">Прогноз на несколько дней</a>
			</div>
		</aside> <!-- /Сайдбар -->



		<div class="container"> <!-- Основная часть: название города, температура, дата и время -->
			<header class="weather__header">
				<h1 class="weather__name">погода.</h1>
			</header>

			<main class="main">
				<h2 class="weather__temp">16&#176;</h2>
				<div class="weather__city-details">
					<div class="weather__city-details-wrapper">
						<h2 class="weather__city">Москва</h2>
						<p class="weather__datetime">
							<time datetime="2023-09-10 17:20">17:20 - Пятница, 12 Сент </time>
						</p>
					</div>
					<div class="weather__icon">
						<img class="weather__img" src="images/weather-icons/day/cloud.png" alt="Облачно">
						<p class="weather__icon-text">Облачно</p>
					</div>
				</div>
			</main>
		</div>
	</div> <!-- /Основная часть: название города, температура, дата и время -->


	<script src="https://kit.fontawesome.com/def1ddea5c.js" crossorigin="anonymous"></script>
	<script src="js/main.min.js"></script>
</body>

</html>